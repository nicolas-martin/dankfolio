appId: com.nicolasmartin.dankfolio
env:
    testAmount: "1.65973075"
    testRecipientAddress: "6hbS1d1JRRta3GtJC7XNo16gg3PTb41QJVzy6kWsZnav"
    solMint: "So11111111111111111111111111111111111111112"
    capturedTokenMint: "CniPCE4b3s8gSUPhUiyMjXnytrEqUrMfSsnbBjLCpump"
    largeAmount: "99"
    smallTestAmount: "0.000000001"
---
- runFlow: ../common/app-setup.yaml

# HACK: Can't find the navigation items
- tapOn:
      point: "85%,95%"
- waitForAnimationToEnd

- assertVisible:
      id: "profile-screen"

- assertVisible:
      id: "send-tokens-button"
- tapOn:
      id: "send-tokens-button"

- assertVisible:
      text: "To"

# Test 6: Test amount percentage buttons (25%, 50%, 75%, 100%)
- assertVisible:
      id: "amount-percentage-button-25"
- assertVisible:
      id: "amount-percentage-button-50"
- assertVisible:
      id: "amount-percentage-button-75"
- assertVisible:
      id: "amount-percentage-button-100"

- tapOn:
      id: "recipient-address-input"
- eraseText
- inputText: "${testRecipientAddress}"
- hideKeyboard

- tapOn:
      id: "recipient-address-input"
- eraseText
- inputText: "invalid-address"
- hideKeyboard
- waitForAnimationToEnd
# Tap outside input field to ensure keyboard is dismissed
- tapOn:
      point: "50%,30%"
- waitForAnimationToEnd
- tapOn:
      id: "send-button"
- assertVisible:
      id: "validation-error-text"
- assertVisible: ".*Invalid Solana address.*"

# Test 9: Test insufficient balance validation with extremely large amount
- tapOn:
      id: "recipient-address-input"
- eraseText
- inputText: "${testRecipientAddress}"
- hideKeyboard
- waitForAnimationToEnd
- tapOn:
      id: "token-selector-amount-input"
- eraseText
- waitForAnimationToEnd
- inputText: "${largeAmount}"
- hideKeyboard
- waitForAnimationToEnd
# Tap outside input field to ensure keyboard is dismissed
- tapOn:
      point: "50%,30%"
- waitForAnimationToEnd
- tapOn:
      id: "send-button"
- assertVisible:
      id: "validation-error-text"
- assertVisible: ".*Insufficient balance.*"
- tapOn:
      id: "amount-percentage-button-100"
- assertVisible:
      id: "send-button"
- tapOn:
      id: "send-button"
- waitForAnimationToEnd
- assertVisible:
      id: "verification-continue-button"
- tapOn:
      id: "verification-continue-button"
- waitForAnimationToEnd
- tapOn:
      id: "confirm-send-button"
- assertNotVisible:
      id: "validation-error-text"
- assertVisible: ".*Transaction Status.*"
- tapOn:
      id: "trade-status-action-button"
- waitForAnimationToEnd
- assertNotVisible: ".*Transaction Status.*"
