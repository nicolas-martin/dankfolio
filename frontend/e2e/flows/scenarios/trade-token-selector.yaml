appId: com.nicolasmartin.dankfolio
env:
    jupSymbol: "jup"
    solSymbol: "sol"
    dankSymbol: "dank"
    usdcSymbol: "usdc"
---
- runFlow: ../common/app-setup.yaml

# Navigate to trade screen via trending coin
- tapOn:
      id: "trending-coin-card-jup.*"
- tapOn:
      id: "trade-button.*"

# # Test 1: Initial SOL -> JUP setup - enter amount first to have visible values
# # SOL price: $98.45, so 0.1 SOL = $9.84
# - tapOn:
#       id: "from-token-selector-amount-input"
# - inputText: "0.1"
# - waitForAnimationToEnd
# - hideKeyboard

# - runFlow:
#       file: ../components/trade-token-selector.yaml
#       env:
#           FROM_SYMBOL: ${solSymbol}
#           FROM_AMOUNT: "0.1"
#           FROM_BALANCE: "2.5"
#           FROM_USD_VALUE: "9.84"
#           TO_SYMBOL: ${jupSymbol}
#           TO_AMOUNT: "11.25"
#           TO_BALANCE: "150"

# Test 2: Change TO token to DANK and validate with amounts
- tapOn:
      id: "to-token-selector-jup.*"
# Wait for modal to open
- waitForAnimationToEnd
# Assert that the token search modal is visible before interacting with it
- assertVisible:
      id: "token-search-input"
- tapOn:
      id: "search-result-dank"

# SOL price: $98.45, so 1 SOL = $98.45
- tapOn:
      id: "from-token-selector-amount-input"
- inputText: "1"
- waitForAnimationToEnd
- hideKeyboard

- runFlow:
      file: ../components/trade-token-selector.yaml
      env:
          FROM_SYMBOL: ${solSymbol}
          FROM_AMOUNT: "1"
          FROM_BALANCE: "2.50"
          FROM_USD_VALUE: "98.45"
          TO_SYMBOL: ${dankSymbol}
          TO_AMOUNT: "2332327.38"
          TO_BALANCE: "5,000,000"

# HACK: SAD
- tapOn:
      id: "swap-coins-button"
- tapOn:
      point: "50%,48%"

# DANK price: $0.000042, so 2344047 DANK â‰ˆ $98.45
- runFlow:
      file: ../components/trade-token-selector.yaml
      env:
          FROM_SYMBOL: ${dankSymbol}
          FROM_AMOUNT: "2332327.38"
          FROM_BALANCE: "5,000,000"
          # it's an approximation
          FROM_USD_VALUE: "97.95"
          TO_SYMBOL: ${solSymbol}
          TO_AMOUNT: "1"
          TO_BALANCE: "2.5"

# Test 4: Change FROM token to USDC and validate with amounts
- tapOn:
      id: "from-token-selector-dank.*"
# Wait for modal to open
- waitForAnimationToEnd
# Assert that the token search modal is visible before interacting with it
- assertVisible:
      id: "token-search-input"
- tapOn:
      id: "search-result-usdc"

# Clear and enter new amount
# USDC price: $1.0, so 100 USDC = $100.00
- tapOn:
      id: "from-token-selector-amount-input"
- inputText: "100"
- waitForAnimationToEnd
- hideKeyboard

- runFlow:
      file: ../components/trade-token-selector.yaml
      env:
          FROM_SYMBOL: ${usdcSymbol}
          FROM_AMOUNT: "100"
          FROM_BALANCE: "1,000"
          FROM_USD_VALUE: "100.00"
          TO_SYMBOL: ${solSymbol}
          TO_AMOUNT: "1.01"
          TO_BALANCE: "2.5"

- tapOn:
      id: "amount-percentage-text-50"
- waitForAnimationToEnd

# USDC price: $1.0, so 500 USDC = $500.00
- runFlow:
      file: ../components/trade-token-selector.yaml
      env:
          FROM_SYMBOL: ${usdcSymbol}
          FROM_AMOUNT: "500"
          FROM_BALANCE: "1,000"
          FROM_USD_VALUE: "500.00"
          TO_SYMBOL: ${solSymbol}
          TO_AMOUNT: "1.01"
          TO_BALANCE: "2.5"

- tapOn:
      id: "from-token-selector-usdc.*"
- waitForAnimationToEnd
- assertVisible:
      id: "token-search-input"
- tapOn:
      id: "search-result-dank"
- tapOn:
      id: "amount-percentage-text-50"

- waitForAnimationToEnd
- runFlow:
      file: ../components/trade-token-selector.yaml
      env:
          FROM_SYMBOL: ${dankSymbol}
          FROM_AMOUNT: "2500000"
          FROM_BALANCE: "5,000,000"
          FROM_USD_VALUE: "105"
          TO_SYMBOL: ${solSymbol}
          TO_AMOUNT: "1.06"
          TO_BALANCE: "2.5"

# swap to usd value
- tapOn:
      id: "from-token-selector-amount-input"
- eraseText
- inputText: "40"
- runFlow:
      file: ../components/trade-token-selector.yaml
      env:
          FROM_SYMBOL: ${dankSymbol}
          FROM_AMOUNT: "40"
          FROM_BALANCE: "5,000,000"
          FROM_USD_VALUE: "952,380.95"
          TO_SYMBOL: ${solSymbol}
          TO_AMOUNT: "0.404"
          TO_BALANCE: "2.5"
