appId: com.nicolasmartin.dankfolio
env:
  LOAD_DEBUG_WALLET: "true"
  E2E_MOCKING_ENABLED: "true"
---
# TokenSelector: Selection Functionality Test
# Tests: calls onSelectToken when a token is selected
# Matches Jest test case from TokenSelector.test.tsx

- launchApp
- assertVisible: 
    text: "Portfolio"
    timeout: 10000

# Navigate to Trade screen
- tapOn: "Trade"
- assertVisible:
    text: "Swap"
    timeout: 5000

# Test token selection in "From" selector
- tapOn:
    id: "from-token-selector"
- assertVisible:
    text: "Search tokens"
    timeout: 5000

# Test selecting SOL token
- tapOn:
    text: "SOL"

# Verify token was selected and modal closed
- assertVisible:
    text: "SOL"  # Should show in selector
    timeout: 3000
- assertNotVisible:
    text: "Search tokens"  # Modal should be closed
    timeout: 2000

# Test selecting different token in "To" selector
- tapOn:
    id: "to-token-selector"
- assertVisible:
    text: "Search tokens"
    timeout: 3000

# Test selecting USDC
- tapOn:
    text: "USDC"

# Verify USDC was selected
- assertVisible:
    text: "USDC"
    timeout: 3000
- assertNotVisible:
    text: "Search tokens"
    timeout: 2000

# Test changing selection in "From" selector
- tapOn:
    id: "from-token-selector"
- assertVisible:
    text: "Search tokens"
    timeout: 3000

# Select a different token (ONE)
- tapOn:
    text: "ONE"

# Verify selection changed
- assertVisible:
    text: "ONE"
    timeout: 3000
- assertNotVisible:
    text: "SOL"  # Previous selection should be replaced
    timeout: 2000

# Test that "To" selector still has USDC
- assertVisible:
    text: "USDC"
    timeout: 3000

# Test selecting same token in both selectors (should be prevented or handled)
- tapOn:
    id: "to-token-selector"
- assertVisible:
    text: "Search tokens"
    timeout: 3000

# Try to select ONE (same as "From" token)
- tapOn:
    text: "ONE"

# Verify appropriate handling (either prevented or swapped)
- assertVisible:
    text: "ONE"
    timeout: 3000

# Test portfolio token selection (if available)
- tapOn:
    id: "from-token-selector"
- assertVisible:
    text: "Search tokens"
    timeout: 3000

# Test selecting a portfolio token (SOL should be in portfolio)
- tapOn:
    text: "SOL"

# Verify portfolio token selection shows balance
- assertVisible:
    text: "SOL"
    timeout: 3000

# Test that amount input becomes available after selection
- assertVisible:
    id: "amount-input"
    timeout: 3000

# Test token selection persistence across navigation
- tapOn: "Portfolio"
- tapOn: "Trade"

# Verify selections are remembered
- assertVisible:
    text: "SOL"
    timeout: 3000 