appId: com.nicolasmartin.dankfolio
env:
  LOAD_DEBUG_WALLET: "true"
  E2E_MOCKING_ENABLED: "true"
---
# TokenSelector: Search Functionality Test
# Tests: opens modal when pressed, search functionality
# Matches Jest test cases from TokenSelector.test.tsx

- launchApp
- assertVisible: 
    text: "Portfolio"
    timeout: 10000

# Navigate to Trade screen
- tapOn: "Trade"
- assertVisible:
    text: "Swap"
    timeout: 5000

# Test opening token selector modal
- tapOn:
    id: "from-token-selector"

# Test that modal opens with search functionality
- assertVisible:
    text: "Search tokens"
    timeout: 5000

# Test search input is present
- assertVisible:
    id: "search-input"
    timeout: 3000

# Test that all available tokens are shown initially
- assertVisible:
    text: "SOL"
    timeout: 3000
- assertVisible:
    text: "USDC"
    timeout: 3000
- assertVisible:
    text: "ONE"
    timeout: 3000
- assertVisible:
    text: "TWO"
    timeout: 3000

# Test search functionality
- tapOn:
    id: "search-input"
- inputText: "SOL"

# Test that search filters results
- assertVisible:
    text: "SOL"
    timeout: 3000
- assertVisible:
    text: "Solana"  # Full name should be visible
    timeout: 3000

# Test that non-matching tokens are hidden
- assertNotVisible:
    text: "USDC"
    timeout: 2000
- assertNotVisible:
    text: "ONE"
    timeout: 2000

# Test clearing search
- clearText
- wait: 1000

# Test that all tokens are shown again
- assertVisible:
    text: "SOL"
    timeout: 3000
- assertVisible:
    text: "USDC"
    timeout: 3000
- assertVisible:
    text: "ONE"
    timeout: 3000

# Test search with partial match
- inputText: "US"
- assertVisible:
    text: "USDC"
    timeout: 3000
- assertVisible:
    text: "USD Coin"  # Full name
    timeout: 3000

# Test that non-matching tokens are filtered out
- assertNotVisible:
    text: "SOL"
    timeout: 2000

# Test search case insensitivity
- clearText
- inputText: "sol"
- assertVisible:
    text: "SOL"
    timeout: 3000

# Test search by full name
- clearText
- inputText: "Solana"
- assertVisible:
    text: "SOL"
    timeout: 3000

# Test no results scenario
- clearText
- inputText: "NONEXISTENT"
- assertNotVisible:
    text: "SOL"
    timeout: 2000
- assertNotVisible:
    text: "USDC"
    timeout: 2000

# Test closing modal without selection
- tapOn:
    id: "close-modal-button"
- assertVisible:
    text: "Swap"  # Back to trade screen 