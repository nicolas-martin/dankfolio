appId: com.nicolasmartin.dankfolio
env:
    jupSymbol: "JUP"
    jupMint: "JUPyiwrYJFskUPiHa7hkeR8VUtAeFoSYbKedZNsDvCN"
    solSymbol: "SOL"
    solMint: "So11111111111111111111111111111111111111112"
    usdcSymbol: "USDC"
    usdcMint: "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"
---
- runFlow: ../common/app-setup.yaml

- tapOn:
      id: "trending-coin-card-${jupMint}"
- tapOn:
      id: "trade-button"

# Test 1: Open TokenSelector modal by tapping from-token-selector (SOL is pre-selected)
- tapOn:
    id: "from-token-selector-${solMint}"
- assertVisible: "Bottom Sheet"
- assertVisible:
      id: "token-search-input"

# Test 2: Search functionality - Filter by symbol "SOL"
- tapOn:
      id: "token-search-input"
- eraseText
- inputText: "${solSymbol}"
- assertVisible:
      id: "search-result-${solMint}"

# Test 3: Clear search and try different search
- eraseText
- inputText: "${usdcSymbol}"
- assertVisible:
      id: "search-result-${usdcMint}"

# Test 4: Cancel modal by swiping down (test cancel behavior)
- swipe:
      start: 50%, 50%
      end: 50%, 90%
- assertNotVisible:
      id: "token-search-input"

# Test 5: Reopen modal and verify it works
- tapOn:
    id: "from-token-selector-${solMint}"
- assertVisible: "Bottom Sheet"
- assertVisible:
      id: "token-search-input"

# Test 6: Select SOL token for FROM selector
- tapOn:
      id: "token-search-input"
- eraseText
- inputText: "${solSymbol}"
- assertVisible:
      id: "search-result-${solMint}"
- tapOn:
      id: "search-result-${solMint}"

# Test 7: Verify modal closes after selection
- assertNotVisible:
    id: "token-search-input"

# Test 8: Verify selected SOL token is displayed in from selector
- waitForAnimationToEnd
- assertVisible:
    text: "Selected token: SOL"

# Test 9: Test "To" token selector (JUP is pre-selected)
- tapOn:
    id: "to-token-selector-${jupMint}"
- assertVisible: "Bottom Sheet"
- assertVisible:
      id: "token-search-input"

# Test 10: Select USDC token for "To" selector (different from FROM)
- tapOn:
      id: "token-search-input"
- inputText: "${usdcSymbol}"
- assertVisible:
      id: "search-result-${usdcMint}"
- tapOn:
      id: "search-result-${usdcMint}"

# Test 11: Verify "To" token selection
- assertNotVisible:
    id: "token-search-input"
- waitForAnimationToEnd
- assertVisible:
    id: "to-token-selector-${usdcMint}"

# Test 12: Final verification - verify both selectors show different tokens using testIDs
- assertVisible:
    id: "from-token-selector-${solMint}"
- assertVisible:
    id: "to-token-selector-${usdcMint}"
