appId: com.nicolasmartin.dankfolio
env:
    jupSymbol: "JUP"
    jupMint: "JUPyiwrYJFskUPiHa7hkeR8VUtAeFoSYbKedZNsDvCN"
    solSymbol: "SOL"
    solMint: "So11111111111111111111111111111111111111112"
    usdcSymbol: "USDC"
    usdcMint: "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"
---
- runFlow: ../common/app-setup.yaml

- tapOn:
      id: "trending-coin-card-${jupMint}"
- tapOn:
      id: "trade-button"

# Test 1: Open TokenSelector modal by tapping from-token-selector
- tapOn:
      id: "from-token-selector"
- assertVisible: "Bottom Sheet"
- assertVisible:
      id: "token-search-input"

# Test 2: Search functionality - Filter by symbol "SOL"
- tapOn:
      id: "token-search-input"
- eraseText
- inputText: "${solSymbol}"
- assertVisible:
      id: "search-result-${solMint}"

# Test 3: Clear search and try different search
- eraseText
- inputText: "${usdcSymbol}"
- assertVisible:
      id: "search-result-${usdcMint}"

# Test 4: Cancel modal by swiping down (test cancel behavior)
- swipe:
      start: 50%, 50%
      end: 50%, 90%
- assertNotVisible:
      id: "token-search-input"

# Test 5: Reopen modal and verify it works
- tapOn:
      id: "from-token-selector"
- assertVisible: "Bottom Sheet"
- assertVisible:
      id: "token-search-input"

# Test 6: Select a token and verify selection
- tapOn:
      id: "token-search-input"
- eraseText
- inputText: "${usdcSymbol}"
- assertVisible:
      id: "search-result-${usdcMint}"
- tapOn:
      id: "search-result-${usdcMint}"

# Test 7: Verify modal closes after selection
- assertNotVisible:
      id: "token-search-input"

# Test 8: Verify selected token is displayed in selector
- assertVisible:
      id: "token-selector-symbol-${usdcMint}"

# Test 9: Test "To" token selector
- tapOn:
      id: "to-token-selector"
- assertVisible: "Bottom Sheet"
- assertVisible:
      id: "token-search-input"

# Test 10: Select different token for "To" selector
- tapOn:
      id: "token-search-input"
- inputText: "${usdcSymbol}"
- assertVisible:
      id: "search-result-${usdcMint}"
- tapOn:
      id: "search-result-${usdcMint}"

# Test 11: Verify "To" token selection
- assertNotVisible:
      id: "token-search-input"
- assertVisible:
      id: "token-selector-symbol-${usdcMint}"

# Test 12: Final verification - both selectors show selected tokens
- assertVisible:
      id: "token-selector-symbol-${usdcMint}"
