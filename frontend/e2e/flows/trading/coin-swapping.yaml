appId: com.nicolasmartin.dankfolio
env:
  LOAD_DEBUG_WALLET: "true"
  E2E_MOCKING_ENABLED: "true"
---
# TradeScreen: Coin Swapping Test
# Tests: handles coin swapping correctly
# Matches Jest test case from TradeScreen.test.tsx

- launchApp
- assertVisible: 
    text: "Portfolio"
    timeout: 10000

# Navigate to Trade screen
- tapOn: "Trade"
- assertVisible:
    text: "Swap"
    timeout: 5000

# Set up initial trade pair (SOL to USDC)
- tapOn:
    id: "from-token-selector"
- tapOn:
    text: "SOL"
- tapOn:
    id: "to-token-selector"
- tapOn:
    text: "USDC"

# Enter amount
- tapOn:
    id: "amount-input"
- inputText: "1"
- wait: 2000

# Verify initial setup
- assertVisible:
    text: "SOL"  # From token
    timeout: 3000
- assertVisible:
    text: "USDC"  # To token
    timeout: 3000
- assertVisible:
    text: "150.5"  # Quote amount
    timeout: 3000

# Test swap button functionality
- tapOn:
    id: "swap-tokens-button"
- wait: 1000

# Verify tokens have swapped positions
- assertVisible:
    text: "USDC"  # Now the from token
    timeout: 3000
- assertVisible:
    text: "SOL"   # Now the to token
    timeout: 3000

# Test that quote updates after swap
- wait: 2000
- assertVisible:
    text: "0.006"  # Approximate reverse quote (1/150.5)
    timeout: 5000

# Test swapping back
- tapOn:
    id: "swap-tokens-button"
- wait: 1000

# Verify back to original state
- assertVisible:
    text: "SOL"   # Back to from token
    timeout: 3000
- assertVisible:
    text: "USDC"  # Back to to token
    timeout: 3000

# Test that amount is preserved during swap
- assertVisible:
    text: "1"     # Amount should remain
    timeout: 3000

# Test quote recalculation
- wait: 2000
- assertVisible:
    text: "150.5"  # Back to original quote
    timeout: 5000

# Test swap with different tokens
- tapOn:
    id: "to-token-selector"
- tapOn:
    text: "ONE"   # Change to test coin

# Verify new pair
- assertVisible:
    text: "SOL"
    timeout: 3000
- assertVisible:
    text: "ONE"
    timeout: 3000

# Test swap with new pair
- tapOn:
    id: "swap-tokens-button"
- wait: 1000

- assertVisible:
    text: "ONE"   # Now from token
    timeout: 3000
- assertVisible:
    text: "SOL"   # Now to token
    timeout: 3000 