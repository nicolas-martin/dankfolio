appId: com.nicolasmartin.dankfolio
env:
  LOAD_DEBUG_WALLET: "true"
  E2E_MOCKING_ENABLED: "true"
---
# TradeScreen: Complete Trade Flow Test
# Tests: executes complete trade flow with confirmation
# Matches Jest test case from TradeScreen.test.tsx

- launchApp
- assertVisible: 
    text: "Portfolio"
    timeout: 10000

# Navigate to Trade screen
- tapOn: "Trade"
- assertVisible:
    text: "Swap"
    timeout: 5000

# Set up trade (SOL to USDC)
- tapOn:
    id: "from-token-selector"
- tapOn:
    text: "SOL"
- tapOn:
    id: "to-token-selector"
- tapOn:
    text: "USDC"

# Enter trade amount
- tapOn:
    id: "amount-input"
- inputText: "1"
- wait: 2000

# Verify quote is loaded
- assertVisible:
    text: "150.5"  # Expected amount out
    timeout: 5000

# Initiate trade
- tapOn:
    id: "swap-button"

# Test confirmation modal appears
- assertVisible:
    text: "Confirm Swap"
    timeout: 5000

# Verify trade details in confirmation
- assertVisible:
    text: "1 SOL"  # From amount
    timeout: 3000
- assertVisible:
    text: "150.5 USDC"  # To amount
    timeout: 3000
- assertVisible:
    text: "15.05"  # Exchange rate
    timeout: 3000
- assertVisible:
    text: "0.1"  # Fee
    timeout: 3000

# Test cancel functionality
- tapOn:
    text: "Cancel"
- assertVisible:
    text: "Swap"  # Back to main trade screen
    timeout: 3000

# Initiate trade again
- tapOn:
    id: "swap-button"
- assertVisible:
    text: "Confirm Swap"
    timeout: 5000

# Confirm the trade
- tapOn:
    text: "Confirm"

# Test status modal appears
- assertVisible:
    text: "Processing"
    timeout: 5000

# Wait for transaction processing
- wait: 3000

# Test success state
- assertVisible:
    text: "Success"
    timeout: 10000
- assertVisible:
    text: "mock_tx_hash"  # Transaction hash from mock
    timeout: 3000

# Test close status modal
- tapOn:
    text: "Close"

# Verify return to trade screen
- assertVisible:
    text: "Swap"
    timeout: 5000

# Verify portfolio refresh (amounts should update)
- tapOn: "Portfolio"
- assertVisible:
    text: "Portfolio"
    timeout: 5000

# Check that balances have updated
- assertVisible:
    text: "SOL"  # Should show updated SOL balance
    timeout: 3000
- assertVisible:
    text: "USDC"  # Should show new USDC balance
    timeout: 3000 